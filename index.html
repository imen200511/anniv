<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GÃ¢teau d'anniversaire avec souffle et musique</title>
<style>
  body {
    background: #fff0f5;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 30px;
    user-select: none;
  }
  .cake {
    margin: 40px auto;
    width: 200px;
    height: 150px;
    position: relative;
    background: pink;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }
  .candle {
    position: absolute;
    top: -50px;
    left: 90px;
    width: 20px;
    height: 50px;
    background: gold;
    border-radius: 3px;
  }
  .flame {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 30px;
    background: orange;
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    animation: flicker 0.3s infinite alternate;
  }
  @keyframes flicker {
    0% { opacity: 1; transform: translateX(-50%) scale(1); }
    100% { opacity: 0.7; transform: translateX(-48%) scale(1.1); }
  }
  .message {
    font-size: 1.2em;
    color: #555;
    margin-top: 20px;
  }
  button {
    margin-top: 30px;
    background: #d63384;
    border: none;
    padding: 10px 20px;
    color: white;
    font-size: 1em;
    border-radius: 8px;
    cursor: pointer;
  }
  button:disabled {
    background: #aaa;
    cursor: default;
  }
</style>
</head>
<body>

<h1>ðŸŽ‰ Joyeux Anniversaire ! ðŸŽ‰</h1>

<div class="cake" id="cake">
  <div class="candle" id="candle" title="Souffle pour Ã©teindre la bougie">
    <div class="flame" id="flame"></div>
  </div>
</div>

<p class="message" id="message">Clique sur "DÃ©marrer" et souffle fort vers ton micro ðŸ’¨</p>
<button id="startBtn">DÃ©marrer le dÃ©tecteur de souffle et la musique</button>

<audio id="happyBirthdayAudio" preload="auto">
  <source src="https://actions.google.com/sounds/v1/human_voices/happy_birthday.ogg" type="audio/ogg">
  <source src="https://actions.google.com/sounds/v1/human_voices/happy_birthday.mp3" type="audio/mpeg">
  Ton navigateur ne supporte pas la lecture audio.
</audio>

<script>
  const flame = document.getElementById('flame');
  const message = document.getElementById('message');
  const startBtn = document.getElementById('startBtn');
  const audio = document.getElementById('happyBirthdayAudio');

  let audioContext;
  let analyser;
  let microphone;
  let dataArray;
  let isBlown = false;

  startBtn.onclick = async () => {
    startBtn.disabled = true;
    message.textContent = "ðŸŽµ Musique en cours et Ã©coute du souffle... Souffle vers ton micro !";

    // DÃ©marre la musique
    audio.play().catch(() => {});

    try {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      microphone = audioContext.createMediaStreamSource(stream);
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 256;
      const bufferLength = analyser.frequencyBinCount;
      dataArray = new Uint8Array(bufferLength);

      microphone.connect(analyser);

      checkVolume();
    } catch (e) {
      message.textContent = "Erreur d'accÃ¨s au micro : " + e.message;
    }
  };

  function checkVolume() {
    analyser.getByteFrequencyData(dataArray);
    let max = 0;
    for (let i = 0; i < dataArray.length; i++) {
      if (dataArray[i] > max) max = dataArray[i];
    }

    // Seuil pour dÃ©tecter un souffle
    if (max > 50 && !isBlown) {
      isBlown = true;
      if (flame) flame.remove();
      message.textContent = "ðŸ’– La bougie est soufflÃ©e ! Joyeux anniversaire ! ðŸ’–";
    }

    if (!isBlown) {
      requestAnimationFrame(checkVolume);
    }
  }
</script>

</body>
</html>
